{/* Header */}
      {!focusMode && (
        <View style={styles.header}>
          {/* Row 1: Back Button + Title + Focus + Collapse */}
          <View style={styles.titleRow}>
            <TouchableOpacity onPress={() => navigation.goBack()} style={styles.backButton}>
              <Icon name="arrow-back" size={24} color={COLORS.white} />
            </TouchableOpacity>

            <Text style={[styles.canvasTitle, { flex: 1, marginRight: 8 }]} numberOfLines={1} ellipsizeMode="tail">
              {canvas.title}
            </Text>

            {/* Focus Mode Button */}
            <TouchableOpacity
              onPress={() => setFocusMode(!focusMode)}
              style={styles.focusModeButton}
            >
              <Icon
                name={focusMode ? "eye-off-outline" : "eye-outline"}
                size={20}
                color={focusMode ? COLORS.purple400 : COLORS.cyan400}
              />
            </TouchableOpacity>

            {/* Collapse/Expand Button */}
            <TouchableOpacity
              onPress={() => setHeaderCollapsed(!headerCollapsed)}
              style={styles.collapseButton}
            >
              <Icon
                name={headerCollapsed ? "chevron-down-outline" : "chevron-up-outline"}
                size={20}
                color={COLORS.cyan400}
              />
            </TouchableOpacity>
          </View>

          {/* Row 2: Action Icons - Collapsible */}
          {!headerCollapsed && (
            <View style={styles.actionsRow}>
              {/* Layers Button */}
              <TouchableOpacity onPress={() => setShowLayerPanel(true)} style={styles.actionButton}>
                <Icon name="layers-outline" size={22} color={COLORS.cyan400} />
              </TouchableOpacity>

              {/* Auto-Format Button */}
              <TouchableOpacity onPress={autoFormatLayers} style={styles.actionButton}>
                <Icon name="grid-outline" size={22} color={COLORS.amber400} />
              </TouchableOpacity>

              {/* Export Button */}
              <TouchableOpacity onPress={exportCanvas} disabled={exporting} style={styles.actionButton}>
                {exporting ? (
                  <ActivityIndicator size="small" color={COLORS.cyan400} />
                ) : (
                  <Icon name="download-outline" size={22} color={COLORS.cyan400} />
                )}
              </TouchableOpacity>

              {/* Music Button - CREATOR ONLY */}
              {userId === canvas.creatorId && (
                <TouchableOpacity
                  onPress={() => setShowMusicLibrary(true)}
                  style={styles.actionButton}
                >
                  <Ionicons
                    name={selectedMusic ? "musical-notes" : "musical-notes-outline"}
                    size={22}
                    color={selectedMusic ? COLORS.cyan400 : COLORS.purple400}
                  />
                  {selectedMusic && <View style={styles.musicIndicator} />}
                </TouchableOpacity>
              )}

              {/* Share Button */}
              <TouchableOpacity onPress={shareCanvas} style={styles.actionButton}>
                <Icon name="share-outline" size={22} color={COLORS.purple400} />
              </TouchableOpacity>

              {/* Like Button */}
              <TouchableOpacity onPress={toggleLike} style={styles.actionButton}>
                <Icon
                  name={canvas?.likedBy?.includes(userId || '') ? "heart" : "heart-outline"}
                  size={22}
                  color={canvas?.likedBy?.includes(userId || '') ? COLORS.red500 : COLORS.red400}
                />
                {canvas?.likeCount ? (
                  <Text style={styles.likeCountBadge}>{canvas.likeCount}</Text>
                ) : null}
              </TouchableOpacity>
            </View>
          )}

          {/* Row 3: Canvas Info */}
          {!headerCollapsed && (
            <View style={styles.headerBottom}>
              <View style={styles.infoItem}>
                <Icon name="time-outline" size={14} color={COLORS.amber400} />
                <Text style={styles.infoText}>Expires in {getTimeRemaining(canvas.expiresAt)}</Text>
              </View>

              <View style={styles.infoDivider} />

              <View style={styles.infoItem}>
                <Icon name="document-outline" size={14} color={COLORS.cyan400} />
                <Text style={styles.infoText}>
                  Page {currentPage + 1} of {canvas.totalPages || 1}
                </Text>
              </View>

              <View style={styles.infoDivider} />

              <View style={styles.infoItem}>
                <Icon name="layers-outline" size={14} color={COLORS.purple400} />
                <Text style={styles.infoText}>
                  {canvas.layers.filter(l => (l.pageIndex ?? 0) === currentPage).length}/{canvas.maxCollaborators} layers
                </Text>
              </View>
            </View>
          )}
        </View>
      )}

      {/* Floating Action Buttons (when header collapsed) */}
      {headerCollapsed && !focusMode && (
        <View style={styles.floatingActions}>
          <TouchableOpacity style={styles.floatingButton} onPress={() => setShowLayerPanel(true)}>
            <Icon name="layers-outline" size={20} color="#fff" />
          </TouchableOpacity>

          {userId === canvas.creatorId && (
            <TouchableOpacity 
              style={[styles.floatingButton, selectedMusic && styles.floatingButtonActive]} 
              onPress={() => setShowMusicLibrary(true)}
            >
              <Icon name="musical-notes-outline" size={20} color="#fff" />
            </TouchableOpacity>
          )}

          <TouchableOpacity style={styles.floatingButton} onPress={shareCanvas}>
            <Icon name="share-outline" size={20} color="#fff" />
          </TouchableOpacity>

          <TouchableOpacity style={styles.floatingButton} onPress={toggleLike}>
            <Icon 
              name={canvas?.likedBy?.includes(userId || '') ? "heart" : "heart-outline"} 
              size={20} 
              color={canvas?.likedBy?.includes(userId || '') ? COLORS.red400 : "#fff"} 
            />
          </TouchableOpacity>
        </View>
      )}

      {/* Exit Focus Mode Button */}
      {focusMode && (
        <TouchableOpacity
          style={styles.exitFocusButton}
          onPress={() => setFocusMode(false)}
        >
          <Ionicons name="close" size={24} color="#fff" />
        </TouchableOpacity>
      )}
